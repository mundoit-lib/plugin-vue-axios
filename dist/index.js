'use strict';var f=require('axios'),zod=require('zod');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var f__default=/*#__PURE__*/_interopDefault(f);exports.axiosInstance=void 0;var g=zod.z.object({baseURL:zod.z.string(),db:zod.z.string(),clientID:zod.z.string(),clientSecret:zod.z.string(),fixURL:zod.z.string(),updateToken:zod.z.function().optional(),onError:zod.z.function().optional()}),c=()=>{if(!exports.axiosInstance)throw new Error("Axios instance is not initialized");return exports.axiosInstance},p=t=>{let e=g.safeParse(t);if(!e.success)throw console.error(e.error),new Error("Invalid Axios configuration");exports.axiosInstance=f__default.default.create({baseURL:e.data.baseURL,headers:{"Content-Type":"application/json"}}),exports.axiosInstance.interceptors.response.use(r=>r,async r=>{let{status:s}=r.response;if(s===401){let o=r.config;if(!o._retry){o._retry=true;try{let n=await x(e.data.fixURL,e.data.clientID,e.data.clientSecret);return o.headers.Authorization=`Bearer ${n.access_token}`,exports.axiosInstance.defaults.headers.common.Authorization=`Bearer ${n.access_token}`,e.data.updateToken&&e.data.updateToken(n),exports.axiosInstance(o)}catch(n){return console.error("Error al actualizar token",n),e.data.onError&&e.data.onError(),Promise.reject(n)}}return e.data.onError&&e.data.onError(),Promise.reject(r)}return e.data.onError&&e.data.onError(),Promise.reject(r)});},x=async(t,e,r)=>{try{let s=localStorage.getItem("refreshToken");if(!s)throw new Error("No hay token de refresco");let{data:o}=await f__default.default.post(`${t}/token`,{grant_type:"refresh_token",client_id:e,client_secret:r,refresh_token:s,notification_token:null});if(o.error||o.error_description)throw new Error(o.error);let n=o.expires_in,l=new Date().getTime()+n*1e3;return localStorage.setItem("accessToken",o.access_token),localStorage.setItem("refreshToken",o.refresh_token),localStorage.setItem("tokenExpireDate",l+""),{...o,nuevaFechaExpiracion:l}}catch(s){throw localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("tokenExpireDate"),s}};var A=(t,e)=>{if(p(e),typeof t.version=="string"&&t.version.startsWith("3.")){t.config.globalProperties.$axios=c();return}t.prototype.$axios=c();};exports.getAxiosInstance=c;exports.initializeAxios=p;exports.install=A;