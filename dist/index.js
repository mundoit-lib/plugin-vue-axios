'use strict';Object.defineProperty(exports,'__esModule',{value:true});var l=require('axios'),zod=require('zod'),c=require('localforage');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var l__default=/*#__PURE__*/_interopDefault(l);var c__default=/*#__PURE__*/_interopDefault(c);exports.axiosInstance=void 0;var g=zod.z.object({baseURL:zod.z.string(),db:zod.z.string(),clientID:zod.z.string(),clientSecret:zod.z.string(),fixURL:zod.z.string(),updateToken:zod.z.function().optional(),onError:zod.z.function().optional()}),f=()=>{if(!exports.axiosInstance)throw new Error("Axios instance is not initialized");return exports.axiosInstance},x=o=>{let e=g.safeParse(o);if(!e.success)throw console.error(e.error),new Error("Invalid Axios configuration");exports.axiosInstance=l__default.default.create({baseURL:e.data.baseURL,headers:{"Content-Type":"application/json"}}),exports.axiosInstance.interceptors.response.use(r=>r,async r=>{let{status:a}=r.response;if(a===401){let t=r.config;if(!t._retry){t._retry=!0;try{let n=await d(e.data.fixURL,e.data.clientID,e.data.clientSecret);return t.headers.Authorization=`Bearer ${n.access_token}`,exports.axiosInstance.defaults.headers.common.Authorization=`Bearer ${n.access_token}`,e.data.updateToken&&e.data.updateToken(n),exports.axiosInstance(t)}catch(n){return console.error("Error al actualizar token",n),e.data.onError&&e.data.onError(),Promise.reject(n)}}return e.data.onError&&e.data.onError(),Promise.reject(r)}return e.data.onError&&e.data.onError(),Promise.reject(r)});},d=async(o,e,r)=>{try{let a=await c__default.default.getItem("refreshToken"),{data:t}=await l__default.default.post(`${o}/token`,{grant_type:"refresh_token",client_id:e,client_secret:r,refresh_token:a,notification_token:null});if(t.error||t.error_description)throw new Error(t.error);let n=t.expires_in,p=new Date().getTime()+n*1e3;return await c__default.default.setItem("accessToken",t.access_token),await c__default.default.setItem("refreshToken",t.refresh_token),await c__default.default.setItem("tokenExpireDate",p),{...t,nuevaFechaExpiracion:p}}catch(a){throw a}};var u=(o,e)=>{if(console.log("Vue",o),console.log("options",e),x(e),typeof o.version=="string"&&o.version.startsWith("3.")){o.config.globalProperties.$axios=f();return}o.prototype.$axios=f();};var _={install:u};exports.default=_;exports.getAxiosInstance=f;exports.initializeAxios=x;exports.install=u;